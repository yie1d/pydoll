
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://pydoll.tech/docs/deep-dive/fundamentals/iframes-and-contexts/">
      
      
        <link rel="prev" href="../typing-system/">
      
      
        <link rel="next" href="../../architecture/">
      
      
        
          <link rel="alternate" href="/docs/" hreflang="en">
        
          <link rel="alternate" href="/docs/pt/" hreflang="pt">
        
          <link rel="alternate" href="/docs/zh/" hreflang="zh">
        
      
      
      <link rel="icon" href="../../../resources/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Iframes & Contexts - Pydoll - Async Web Automation Library</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../resources/stylesheets/termynal.css">
    
      <link rel="stylesheet" href="../../../resources/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#iframes-oopifs-and-execution-contexts-deep-dive" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Pydoll - Async Web Automation Library" class="md-header__button md-logo" aria-label="Pydoll - Async Web Automation Library" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11 15H6l7-14v8h5l-7 14z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Pydoll - Async Web Automation Library
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Iframes & Contexts
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Dark Mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Dark Mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Light Mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Light Mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/docs/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/docs/pt/" hreflang="pt" class="md-select__link">
              Português (BR)
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/docs/zh/" hreflang="zh" class="md-select__link">
              中文
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/autoscrape-labs/pydoll" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    autoscrape-labs/pydoll
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Pydoll

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../features/" class="md-tabs__link">
          
  
  
    
  
  Features

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  Deep Dive

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../api/" class="md-tabs__link">
          
  
  
    
  
  API Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Pydoll - Async Web Automation Library" class="md-nav__button md-logo" aria-label="Pydoll - Async Web Automation Library" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11 15H6l7-14v8h5l-7 14z"/></svg>

    </a>
    Pydoll - Async Web Automation Library
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/autoscrape-labs/pydoll" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    autoscrape-labs/pydoll
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pydoll
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../features/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/core-concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Concepts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/element-finding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Element Finding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Automation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Automation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/automation/human-interactions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Human-Like Interactions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/automation/keyboard-control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Keyboard Control
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/automation/file-operations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    File Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/automation/iframes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IFrames
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/automation/screenshots-and-pdfs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Screenshots & PDF
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Network
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Network
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/network/monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network Monitoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/network/interception/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Request Interception
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/network/http-requests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Browser-Context HTTP Requests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Browser Management
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Browser Management
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/browser-management/tabs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi-Tab Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/browser-management/contexts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Browser Contexts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/browser-management/cookies-sessions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cookies & Sessions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Configuration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/configuration/browser-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Browser Options
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/configuration/browser-preferences/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Browser Preferences
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/configuration/proxy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Proxy Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_8" >
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Advanced
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Advanced
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/advanced/behavioral-captcha-bypass/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Behavioral Captcha Bypass
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/advanced/event-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Event System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/advanced/remote-connections/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Remote Connections
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../features/advanced/decorators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Retry Decorator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Deep Dive
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Deep Dive
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Core Fundamentals
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core Fundamentals
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cdp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chrome DevTools Protocol
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../connection-layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Connection Layer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../typing-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python Type System
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Iframes & Contexts
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Iframes & Contexts
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foundation-the-document-object-model-dom" class="md-nav__link">
    <span class="md-ellipsis">
      
        Foundation: The Document Object Model (DOM)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Foundation: The Document Object Model (DOM)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-the-dom" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is the DOM?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dom-tree-properties" class="md-nav__link">
    <span class="md-ellipsis">
      
        DOM Tree Properties
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-this-matters-for-iframes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why This Matters for Iframes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-are-iframes-and-why-they-matter" class="md-nav__link">
    <span class="md-ellipsis">
      
        What are Iframes and Why They Matter
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="What are Iframes and Why They Matter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#definition" class="md-nav__link">
    <span class="md-ellipsis">
      
        Definition
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Use Cases
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-model-same-origin-policy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Model: Same-Origin Policy
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-challenge-out-of-process-iframes-oopifs" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Challenge: Out-of-Process Iframes (OOPIFs)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Challenge: Out-of-Process Iframes (OOPIFs)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-are-oopifs" class="md-nav__link">
    <span class="md-ellipsis">
      
        What are OOPIFs?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-oopifs-complicate-automation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why OOPIFs Complicate Automation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-traditional-approach-manual-context-switching" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Traditional Approach (Manual Context Switching)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydolls-solution-transparent-context-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pydoll's Solution: Transparent Context Resolution
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chrome-devtools-protocol-and-frame-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chrome DevTools Protocol and Frame Management
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chrome DevTools Protocol and Frame Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#relevant-cdp-domains" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relevant CDP Domains
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Relevant CDP Domains">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-page-domain" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Page Domain
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-dom-domain" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. DOM Domain
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-target-domain" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Target Domain
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-runtime-domain" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Runtime Domain
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-contexts-and-isolated-worlds" class="md-nav__link">
    <span class="md-ellipsis">
      
        Execution Contexts and Isolated Worlds
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Execution Contexts and Isolated Worlds">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-an-execution-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is an Execution Context?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-contexts-per-frame" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multiple Contexts per Frame
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-an-isolated-world" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is an Isolated World?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-pydoll-uses-isolated-worlds-for-iframes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why Pydoll Uses Isolated Worlds for Iframes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cdp-identifiers-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        CDP Identifiers Reference
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CDP Identifiers Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#identifier-relationships" class="md-nav__link">
    <span class="md-ellipsis">
      
        Identifier Relationships
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-representation-in-pydoll" class="md-nav__link">
    <span class="md-ellipsis">
      
        Code Representation in Pydoll
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pydolls-resolution-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pydoll's Resolution Pipeline
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pydoll&#39;s Resolution Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#high-level-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        High-Level Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-by-step-deep-dive" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step-by-Step Deep Dive
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step-by-Step Deep Dive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-describe-the-iframe-element" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Describe the Iframe Element
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-resolve-frame-by-owner-backendnodeid-matching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Resolve Frame by Owner (backendNodeId matching)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-resolve-oopif-by-parent-frame" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Resolve OOPIF by Parent Frame
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-create-isolated-world" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Create Isolated World
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-pin-the-iframe-document-as-a-runtime-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Pin the Iframe Document as a Runtime Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-cache-and-propagate-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6: Cache and Propagate Context
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-routing-and-flattened-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Session Routing and Flattened Mode
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Session Routing and Flattened Mode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-flattened-session-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Flattened Session Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-session-routing-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How Session Routing Works
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydolls-command-routing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pydoll's Command Routing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extended-command-typing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extended Command Typing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Considerations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#caching-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Caching Strategy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimization-direct-child-target-lookup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimization: Direct Child Target Lookup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asynchronous-parallel-resolution-future-enhancement" class="md-nav__link">
    <span class="md-ellipsis">
      
        Asynchronous Parallel Resolution (Future Enhancement)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failure-modes-and-debugging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Failure Modes and Debugging
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Failure Modes and Debugging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-failure-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Failure Scenarios
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Failure Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-invalidiframe-unable-to-resolve-frameid" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. InvalidIFrame: Unable to resolve frameId
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-invalidiframe-unable-to-create-isolated-world" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. InvalidIFrame: Unable to create isolated world
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-invalidiframe-unable-to-obtain-document-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. InvalidIFrame: Unable to obtain document reference
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-session-routing-failures-command-times-out-or-returns-error" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Session routing failures (command times out or returns error)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagnostic-tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        Diagnostic Tools
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Diagnostic Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-cdp-logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enable CDP logging
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-iframe-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inspect iframe context
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conclusion
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-reading" class="md-nav__link">
    <span class="md-ellipsis">
      
        Further Reading
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../architecture/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Internal Architecture
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_3" id="__nav_3_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Internal Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/browser-domain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Browser Domain
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/tab-domain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tab Domain
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/webelement-domain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WebElement Domain
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/find-elements-mixin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FindElements Mixin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/event-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Event Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/browser-requests-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Browser Requests Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../network/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Network & Security
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4" id="__nav_3_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Network & Security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network/network-fundamentals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network Fundamentals
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network/http-proxies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    HTTP/HTTPS Proxies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network/socks-proxies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SOCKS Proxies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network/proxy-detection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Proxy Detection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network/build-proxy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Building Proxy Servers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../network/proxy-legal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Legal & Ethical
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../fingerprinting/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Fingerprinting
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5" id="__nav_3_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Fingerprinting
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fingerprinting/network-fingerprinting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network Fingerprinting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fingerprinting/browser-fingerprinting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Browser Fingerprinting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fingerprinting/behavioral-fingerprinting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Behavioral Fingerprinting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fingerprinting/evasion-techniques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Evasion Techniques
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Practical Guides
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_6" id="__nav_3_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Practical Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/selectors-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CSS Selectors vs XPath
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../api/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Browser
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Browser
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/browser/chrome/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chrome
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/browser/edge/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Edge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/browser/options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Options
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/browser/tab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tab
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/browser/requests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Requests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/browser/managers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Managers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Elements
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Elements
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/elements/web_element/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WebElement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/elements/mixins/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mixins
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Connection
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Connection
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/connection/connection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Connection Handler
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/connection/managers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Managers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../api/commands/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Commands
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Commands
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/commands/browser/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Browser
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/commands/dom/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DOM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/commands/input/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Input
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/commands/network/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/commands/page/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Page
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/commands/runtime/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Runtime
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/commands/storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/commands/target/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Target
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/commands/fetch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fetch
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Protocol
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Protocol
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/protocol/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Base Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/protocol/browser/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Browser
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/protocol/dom/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DOM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/protocol/fetch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fetch
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/protocol/input/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Input
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/protocol/network/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/protocol/page/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Page
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/protocol/runtime/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Runtime
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/protocol/storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/protocol/target/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Target
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_7" >
        
          
          <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/core/constants/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Constants
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/core/exceptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/core/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foundation-the-document-object-model-dom" class="md-nav__link">
    <span class="md-ellipsis">
      
        Foundation: The Document Object Model (DOM)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Foundation: The Document Object Model (DOM)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-the-dom" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is the DOM?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dom-tree-properties" class="md-nav__link">
    <span class="md-ellipsis">
      
        DOM Tree Properties
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-this-matters-for-iframes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why This Matters for Iframes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-are-iframes-and-why-they-matter" class="md-nav__link">
    <span class="md-ellipsis">
      
        What are Iframes and Why They Matter
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="What are Iframes and Why They Matter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#definition" class="md-nav__link">
    <span class="md-ellipsis">
      
        Definition
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Use Cases
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-model-same-origin-policy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Model: Same-Origin Policy
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-challenge-out-of-process-iframes-oopifs" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Challenge: Out-of-Process Iframes (OOPIFs)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Challenge: Out-of-Process Iframes (OOPIFs)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-are-oopifs" class="md-nav__link">
    <span class="md-ellipsis">
      
        What are OOPIFs?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-oopifs-complicate-automation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why OOPIFs Complicate Automation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-traditional-approach-manual-context-switching" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Traditional Approach (Manual Context Switching)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydolls-solution-transparent-context-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pydoll's Solution: Transparent Context Resolution
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#chrome-devtools-protocol-and-frame-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chrome DevTools Protocol and Frame Management
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Chrome DevTools Protocol and Frame Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#relevant-cdp-domains" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relevant CDP Domains
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Relevant CDP Domains">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-page-domain" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Page Domain
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-dom-domain" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. DOM Domain
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-target-domain" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Target Domain
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-runtime-domain" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Runtime Domain
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-contexts-and-isolated-worlds" class="md-nav__link">
    <span class="md-ellipsis">
      
        Execution Contexts and Isolated Worlds
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Execution Contexts and Isolated Worlds">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-an-execution-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is an Execution Context?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-contexts-per-frame" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multiple Contexts per Frame
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-an-isolated-world" class="md-nav__link">
    <span class="md-ellipsis">
      
        What is an Isolated World?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-pydoll-uses-isolated-worlds-for-iframes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why Pydoll Uses Isolated Worlds for Iframes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cdp-identifiers-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        CDP Identifiers Reference
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CDP Identifiers Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#identifier-relationships" class="md-nav__link">
    <span class="md-ellipsis">
      
        Identifier Relationships
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-representation-in-pydoll" class="md-nav__link">
    <span class="md-ellipsis">
      
        Code Representation in Pydoll
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pydolls-resolution-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pydoll's Resolution Pipeline
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pydoll&#39;s Resolution Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#high-level-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        High-Level Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-by-step-deep-dive" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step-by-Step Deep Dive
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step-by-Step Deep Dive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-describe-the-iframe-element" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Describe the Iframe Element
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-resolve-frame-by-owner-backendnodeid-matching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Resolve Frame by Owner (backendNodeId matching)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-resolve-oopif-by-parent-frame" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Resolve OOPIF by Parent Frame
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-create-isolated-world" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Create Isolated World
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-pin-the-iframe-document-as-a-runtime-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Pin the Iframe Document as a Runtime Object
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-6-cache-and-propagate-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 6: Cache and Propagate Context
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-routing-and-flattened-mode" class="md-nav__link">
    <span class="md-ellipsis">
      
        Session Routing and Flattened Mode
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Session Routing and Flattened Mode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-flattened-session-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Flattened Session Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-session-routing-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How Session Routing Works
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydolls-command-routing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pydoll's Command Routing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extended-command-typing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extended Command Typing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Considerations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#caching-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Caching Strategy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimization-direct-child-target-lookup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimization: Direct Child Target Lookup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asynchronous-parallel-resolution-future-enhancement" class="md-nav__link">
    <span class="md-ellipsis">
      
        Asynchronous Parallel Resolution (Future Enhancement)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failure-modes-and-debugging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Failure Modes and Debugging
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Failure Modes and Debugging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-failure-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Failure Scenarios
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Failure Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-invalidiframe-unable-to-resolve-frameid" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. InvalidIFrame: Unable to resolve frameId
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-invalidiframe-unable-to-create-isolated-world" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. InvalidIFrame: Unable to create isolated world
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-invalidiframe-unable-to-obtain-document-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. InvalidIFrame: Unable to obtain document reference
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-session-routing-failures-command-times-out-or-returns-error" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Session routing failures (command times out or returns error)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagnostic-tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        Diagnostic Tools
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Diagnostic Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-cdp-logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enable CDP logging
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-iframe-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inspect iframe context
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conclusion
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-reading" class="md-nav__link">
    <span class="md-ellipsis">
      
        Further Reading
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Pydoll
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../../" class="md-path__link">
          
  <span class="md-ellipsis">
    Deep Dive
  </span>

        </a>
      </li>
    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../" class="md-path__link">
          
  <span class="md-ellipsis">
    Core Fundamentals
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="iframes-oopifs-and-execution-contexts-deep-dive">Iframes, OOPIFs and Execution Contexts (Deep Dive)</h1>
<p>Understanding how browser automation handles iframes is critical for building robust automation tools. This comprehensive guide explores the technical foundations of iframe handling in Pydoll, covering the Document Object Model (DOM), Chrome DevTools Protocol (CDP) mechanics, execution contexts, isolated worlds, and the sophisticated resolution pipeline that makes iframe interaction seamless.</p>
<div class="admonition info">
<p class="admonition-title">Practical usage first</p>
<p>If you just need to use iframes in your automation scripts, start with the feature guide: <strong>Features → Automation → IFrames</strong>.<br />
This deep dive explains the architectural decisions, protocol nuances, and internal implementation details.</p>
</div>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#foundation-the-document-object-model-dom">Foundation: The Document Object Model (DOM)</a></li>
<li><a href="#what-are-iframes-and-why-they-matter">What are Iframes and Why They Matter</a></li>
<li><a href="#the-challenge-out-of-process-iframes-oopifs">The Challenge: Out-of-Process Iframes (OOPIFs)</a></li>
<li><a href="#chrome-devtools-protocol-and-frame-management">Chrome DevTools Protocol and Frame Management</a></li>
<li><a href="#execution-contexts-and-isolated-worlds">Execution Contexts and Isolated Worlds</a></li>
<li><a href="#cdp-identifiers-reference">CDP Identifiers Reference</a></li>
<li><a href="#pydolls-resolution-pipeline">Pydoll's Resolution Pipeline</a></li>
<li><a href="#session-routing-and-flattened-mode">Session Routing and Flattened Mode</a></li>
<li><a href="#implementation-deep-dive">Implementation Deep Dive</a></li>
<li><a href="#performance-considerations">Performance Considerations</a></li>
<li><a href="#failure-modes-and-debugging">Failure Modes and Debugging</a></li>
</ol>
<hr />
<h2 id="foundation-the-document-object-model-dom">Foundation: The Document Object Model (DOM)</h2>
<p>Before diving into iframes, we must understand the DOM—the tree structure that represents an HTML document in memory.</p>
<h3 id="what-is-the-dom">What is the DOM?</h3>
<p>The <strong>Document Object Model</strong> is a programming interface for HTML and XML documents. It represents the page structure as a tree of nodes, where each node corresponds to a part of the document:</p>
<ul>
<li><strong>Element nodes</strong>: HTML tags like <code>&lt;div&gt;</code>, <code>&lt;iframe&gt;</code>, <code>&lt;button&gt;</code></li>
<li><strong>Text nodes</strong>: The actual text content</li>
<li><strong>Attribute nodes</strong>: Element attributes like <code>id</code>, <code>class</code>, <code>src</code></li>
<li><strong>Document node</strong>: The root of the tree</li>
</ul>
<pre class="mermaid"><code>graph TD
    Document[Document] --&gt; HTML[html element]
    HTML --&gt; Head[head element]
    HTML --&gt; Body[body element]
    Body --&gt; Div1[div element]
    Body --&gt; Div2[div element]
    Div1 --&gt; Text1[text node: 'Hello']
    Div2 --&gt; Iframe[iframe element]
    Iframe --&gt; IframeDoc[iframe's document]
    IframeDoc --&gt; IframeBody[iframe body]
    IframeBody --&gt; IframeContent[iframe content...]</code></pre>
<h3 id="dom-tree-properties">DOM Tree Properties</h3>
<ol>
<li><strong>Hierarchical structure</strong>: Every node has a parent (except Document) and can have children</li>
<li><strong>Node identification</strong>: Nodes can be identified by:</li>
<li><code>nodeId</code>: Internal identifier within a document context (DOM domain)</li>
<li><code>backendNodeId</code>: Stable identifier that can reference nodes across different documents</li>
<li><strong>Live representation</strong>: Changes to the DOM are reflected immediately in the tree</li>
</ol>
<h3 id="why-this-matters-for-iframes">Why This Matters for Iframes</h3>
<p>Each <code>&lt;iframe&gt;</code> element creates a <strong>new, independent DOM tree</strong>. The iframe element itself exists in the parent's DOM, but the content loaded into the iframe has its own complete Document node and tree structure. This separation is the foundation of all iframe complexity.</p>
<hr />
<h2 id="what-are-iframes-and-why-they-matter">What are Iframes and Why They Matter</h2>
<h3 id="definition">Definition</h3>
<p>An <strong>iframe</strong> (inline frame) is an HTML element (<code>&lt;iframe&gt;</code>) that embeds another HTML document within the current page. The embedded document maintains its own context, including:</p>
<ul>
<li>Independent HTML structure and DOM tree</li>
<li>Separate JavaScript execution environment</li>
<li>Its own CSS styling (unless explicitly shared)</li>
<li>Distinct navigation history</li>
</ul>
<div class="language-html highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Parent Page<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>  <span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://example.com/embedded.html&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;content-frame&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>More parent content<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></code></pre></div>
<h3 id="common-use-cases">Common Use Cases</h3>
<table>
<thead>
<tr>
<th>Use Case</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Third-party widgets</strong></td>
<td>Embed external content safely</td>
<td>Payment forms, social media feeds, chat widgets</td>
</tr>
<tr>
<td><strong>Content isolation</strong></td>
<td>Sandbox untrusted content</td>
<td>User-generated HTML, advertisements</td>
</tr>
<tr>
<td><strong>Modular architecture</strong></td>
<td>Reusable components</td>
<td>Dashboard widgets, plugin systems</td>
</tr>
<tr>
<td><strong>Cross-origin content</strong></td>
<td>Load resources from different domains</td>
<td>Maps, video players, analytics dashboards</td>
</tr>
</tbody>
</table>
<h3 id="security-model-same-origin-policy">Security Model: Same-Origin Policy</h3>
<p>The browser enforces a <strong>Same-Origin Policy</strong> for iframes:</p>
<ul>
<li><strong>Same-origin iframes</strong>: Parent can access iframe's DOM via JavaScript (<code>iframe.contentDocument</code>)</li>
<li><strong>Cross-origin iframes</strong>: Parent cannot access iframe's DOM directly (security restriction)</li>
</ul>
<p>This security boundary is why automation tools need special mechanisms (like CDP) to interact with iframe content.</p>
<div class="admonition warning">
<p class="admonition-title">Important for automation</p>
<p>Traditional JavaScript-based automation (like Selenium's early approaches) cannot directly access cross-origin iframe content due to browser security. CDP operates at a lower level, bypassing this limitation for debugging purposes.</p>
</div>
<hr />
<h2 id="the-challenge-out-of-process-iframes-oopifs">The Challenge: Out-of-Process Iframes (OOPIFs)</h2>
<h3 id="what-are-oopifs">What are OOPIFs?</h3>
<p>Modern Chromium uses <strong>site isolation</strong> for security and stability. This means different origins may be rendered in separate OS processes. An iframe from a different origin becomes an <strong>Out-of-Process Iframe (OOPIF)</strong>.</p>
<pre class="mermaid"><code>graph LR
    subgraph "Process 1: example.com"
        MainPage[Main Page DOM]
    end

    subgraph "Process 2: widget.com"
        IframeDOM[Iframe DOM]
    end

    MainPage -.Process boundary.-&gt; IframeDOM</code></pre>
<h3 id="why-oopifs-complicate-automation">Why OOPIFs Complicate Automation</h3>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>In-Process Iframe</th>
<th>Out-of-Process Iframe (OOPIF)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>DOM access</strong></td>
<td>Shared document tree in memory</td>
<td>Separate target with own document</td>
</tr>
<tr>
<td><strong>Command routing</strong></td>
<td>Single connection</td>
<td>Requires target attachment and session routing</td>
</tr>
<tr>
<td><strong>Frame tree</strong></td>
<td>All frames in one tree</td>
<td>Root frame + separate targets for OOPIFs</td>
</tr>
<tr>
<td><strong>JavaScript context</strong></td>
<td>Same execution context</td>
<td>Different execution context per process</td>
</tr>
<tr>
<td><strong>CDP communication</strong></td>
<td>Direct commands</td>
<td>Commands must include <code>sessionId</code></td>
</tr>
</tbody>
</table>
<h3 id="the-traditional-approach-manual-context-switching">The Traditional Approach (Manual Context Switching)</h3>
<p>Without sophisticated handling, automating OOPIFs requires:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Traditional (manual) approach with other tools</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">main_page</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">get_page</span><span class="p">()</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">iframe_element</span> <span class="o">=</span> <span class="n">main_page</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s2">&quot;iframe-id&quot;</span><span class="p">)</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="c1"># Must manually switch context</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="n">driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="n">iframe_element</span><span class="p">)</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="c1"># Now commands target the iframe</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="n">button</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s2">&quot;button-in-iframe&quot;</span><span class="p">)</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="n">button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="c1"># Must manually switch back</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="n">driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">default_content</span><span class="p">()</span>
</span></code></pre></div>
<p><strong>Problems with this approach:</strong></p>
<ol>
<li><strong>Developer burden</strong>: Every iframe requires explicit context management</li>
<li><strong>Nested iframes</strong>: Each level needs another switch</li>
<li><strong>OOPIF detection</strong>: Hard to know when manual attachment is needed</li>
<li><strong>Error-prone</strong>: Forget to switch back → subsequent commands fail</li>
<li><strong>Not composable</strong>: Helper functions must know their iframe context</li>
</ol>
<h3 id="pydolls-solution-transparent-context-resolution">Pydoll's Solution: Transparent Context Resolution</h3>
<p>Pydoll eliminates manual context switching by resolving iframe contexts automatically:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># Pydoll approach (no manual switching)</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">iframe</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tab</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;iframe-id&quot;</span><span class="p">)</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">button</span> <span class="o">=</span> <span class="k">await</span> <span class="n">iframe</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;button-in-iframe&quot;</span><span class="p">)</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="k">await</span> <span class="n">button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="c1"># Nested iframes? Same pattern</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="n">outer</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tab</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;outer-iframe&quot;</span><span class="p">)</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="n">inner</span> <span class="o">=</span> <span class="k">await</span> <span class="n">outer</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">tag_name</span><span class="o">=</span><span class="s2">&quot;iframe&quot;</span><span class="p">)</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="n">button</span> <span class="o">=</span> <span class="k">await</span> <span class="n">inner</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Submit&quot;</span><span class="p">)</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="k">await</span> <span class="n">button</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</span></code></pre></div>
<p>The complexity is handled internally. Let's explore how.</p>
<hr />
<h2 id="chrome-devtools-protocol-and-frame-management">Chrome DevTools Protocol and Frame Management</h2>
<p>As discussed in <a href="../cdp/">Deep Dive → Fundamentals → Chrome DevTools Protocol</a>, CDP provides comprehensive browser control via WebSocket communication. Frame management is spread across multiple CDP domains.</p>
<h3 id="relevant-cdp-domains">Relevant CDP Domains</h3>
<h4 id="1-page-domain">1. <strong>Page Domain</strong></h4>
<p>Manages page lifecycle, frames, and navigation.</p>
<p><strong>Key methods:</strong></p>
<ul>
<li>
<p><code>Page.getFrameTree()</code>: Returns the hierarchical structure of all frames in a page
  <div class="language-json highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="nt">&quot;frameTree&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="nt">&quot;frame&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;main-frame-id&quot;</span><span class="p">,</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">      </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://example.com&quot;</span><span class="p">,</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">      </span><span class="nt">&quot;securityOrigin&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://example.com&quot;</span><span class="p">,</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">      </span><span class="nt">&quot;mimeType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text/html&quot;</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">    </span><span class="nt">&quot;childFrames&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">        </span><span class="nt">&quot;frame&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">          </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;child-frame-id&quot;</span><span class="p">,</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">          </span><span class="nt">&quot;parentId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;main-frame-id&quot;</span><span class="p">,</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">          </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://widget.com/embed&quot;</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
<li>
<p><code>Page.createIsolatedWorld(frameId, worldName)</code>: Creates a new JavaScript execution context in a specific frame
  <div class="language-json highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="nt">&quot;executionContextId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
</ul>
<p><strong>Pydoll usage:</strong> </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># From pydoll/elements/web_element.py</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nd">@staticmethod</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_get_frame_tree_for</span><span class="p">(</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>    <span class="n">handler</span><span class="p">:</span> <span class="n">ConnectionHandler</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FrameTree</span><span class="p">:</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the Page frame tree for the given connection/target.&quot;&quot;&quot;</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    <span class="n">command</span> <span class="o">=</span> <span class="n">PageCommands</span><span class="o">.</span><span class="n">get_frame_tree</span><span class="p">()</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    <span class="k">if</span> <span class="n">session_id</span><span class="p">:</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>        <span class="n">command</span><span class="p">[</span><span class="s1">&#39;sessionId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">session_id</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>    <span class="n">response</span><span class="p">:</span> <span class="n">GetFrameTreeResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>    <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">][</span><span class="s1">&#39;frameTree&#39;</span><span class="p">]</span>
</span></code></pre></div>
<h4 id="2-dom-domain">2. <strong>DOM Domain</strong></h4>
<p>Provides access to the DOM structure.</p>
<p><strong>Key methods:</strong></p>
<ul>
<li>
<p><code>DOM.describeNode(objectId)</code>: Returns detailed information about a DOM node
  <div class="language-json highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="nt">&quot;node&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="nt">&quot;nodeId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span><span class="nt">&quot;backendNodeId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">456</span><span class="p">,</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="nt">&quot;nodeName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;IFRAME&quot;</span><span class="p">,</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span><span class="nt">&quot;frameId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;parent-frame-id&quot;</span><span class="p">,</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span><span class="nt">&quot;contentDocument&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">      </span><span class="nt">&quot;frameId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iframe-frame-id&quot;</span><span class="p">,</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">      </span><span class="nt">&quot;documentURL&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://embedded.com/page.html&quot;</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
<li>
<p><code>DOM.getFrameOwner(frameId)</code>: Returns the <code>backendNodeId</code> of the <code>&lt;iframe&gt;</code> element that owns a frame
  <div class="language-json highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">  </span><span class="nt">&quot;backendNodeId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">456</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
</ul>
<p><strong>Pydoll usage:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># From pydoll/elements/web_element.py</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nd">@staticmethod</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_owner_backend_for</span><span class="p">(</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    <span class="n">handler</span><span class="p">:</span> <span class="n">ConnectionHandler</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">frame_id</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the backendNodeId of the DOM element that owns the given frame.&quot;&quot;&quot;</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>    <span class="n">command</span> <span class="o">=</span> <span class="n">DomCommands</span><span class="o">.</span><span class="n">get_frame_owner</span><span class="p">(</span><span class="n">frame_id</span><span class="o">=</span><span class="n">frame_id</span><span class="p">)</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>    <span class="k">if</span> <span class="n">session_id</span><span class="p">:</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>        <span class="n">command</span><span class="p">[</span><span class="s1">&#39;sessionId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">session_id</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>    <span class="n">response</span><span class="p">:</span> <span class="n">GetFrameOwnerResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;backendNodeId&#39;</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="3-target-domain">3. <strong>Target Domain</strong></h4>
<p>Manages browser targets (pages, iframes, workers, etc.).</p>
<p><strong>Key methods:</strong></p>
<ul>
<li>
<p><code>Target.getTargets()</code>: Lists all available targets
  <div class="language-json highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">  </span><span class="nt">&quot;targetInfos&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">      </span><span class="nt">&quot;targetId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;page-target-id&quot;</span><span class="p">,</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;page&quot;</span><span class="p">,</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Main Page&quot;</span><span class="p">,</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">      </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://example.com&quot;</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">      </span><span class="nt">&quot;targetId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iframe-target-id&quot;</span><span class="p">,</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iframe&quot;</span><span class="p">,</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">      </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://widget.com/embed&quot;</span><span class="p">,</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">      </span><span class="nt">&quot;parentFrameId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;main-frame-id&quot;</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
<li>
<p><code>Target.attachToTarget(targetId, flatten)</code>: Attaches to a target for debugging</p>
</li>
<li>When <code>flatten=true</code>: Returns a <code>sessionId</code> for routing commands in flattened mode</li>
<li>All communication happens over the same WebSocket, differentiated by <code>sessionId</code></li>
</ul>
<p><strong>Pydoll usage:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># From pydoll/elements/web_element.py (simplified)</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_resolve_oopif_by_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_frame_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Resolve an OOPIF using the parent frame id.&quot;&quot;&quot;</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>    <span class="n">browser_handler</span> <span class="o">=</span> <span class="n">ConnectionHandler</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>    <span class="n">targets_response</span><span class="p">:</span> <span class="n">GetTargetsResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="n">browser_handler</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>        <span class="n">TargetCommands</span><span class="o">.</span><span class="n">get_targets</span><span class="p">()</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>    <span class="p">)</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>    <span class="n">target_infos</span> <span class="o">=</span> <span class="n">targets_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;targetInfos&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>    <span class="c1"># Find targets whose parentFrameId matches</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>    <span class="n">direct_children</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>        <span class="n">target_info</span> <span class="k">for</span> <span class="n">target_info</span> <span class="ow">in</span> <span class="n">target_infos</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>        <span class="k">if</span> <span class="n">target_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parentFrameId&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">parent_frame_id</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>    <span class="p">]</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>    <span class="k">if</span> <span class="n">direct_children</span><span class="p">:</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>        <span class="n">attach_response</span><span class="p">:</span> <span class="n">AttachToTargetResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="n">browser_handler</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>            <span class="n">TargetCommands</span><span class="o">.</span><span class="n">attach_to_target</span><span class="p">(</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>                <span class="n">target_id</span><span class="o">=</span><span class="n">direct_children</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;targetId&#39;</span><span class="p">],</span> 
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>                <span class="n">flatten</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>            <span class="p">)</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>        <span class="p">)</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>        <span class="n">attached_session_id</span> <span class="o">=</span> <span class="n">attach_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sessionId&#39;</span><span class="p">)</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>        <span class="c1"># ... use session_id for subsequent commands</span>
</span></code></pre></div>
<h4 id="4-runtime-domain">4. <strong>Runtime Domain</strong></h4>
<p>Executes JavaScript and manages execution contexts.</p>
<p><strong>Key methods:</strong></p>
<ul>
<li><code>Runtime.evaluate(expression, contextId)</code>: Evaluates JavaScript in a specific execution context</li>
<li><code>Runtime.callFunctionOn(functionDeclaration, objectId)</code>: Calls a function with a specific object as <code>this</code></li>
</ul>
<p><strong>Pydoll usage for iframe document access:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># From pydoll/elements/web_element.py</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_set_iframe_document_object_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">execution_context_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate document.documentElement in iframe context and cache its object id.&quot;&quot;&quot;</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>    <span class="n">evaluate_command</span> <span class="o">=</span> <span class="n">RuntimeCommands</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>        <span class="n">expression</span><span class="o">=</span><span class="s1">&#39;document.documentElement&#39;</span><span class="p">,</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>        <span class="n">context_id</span><span class="o">=</span><span class="n">execution_context_id</span><span class="p">,</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>    <span class="p">)</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iframe_context</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iframe_context</span><span class="o">.</span><span class="n">session_id</span><span class="p">:</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>        <span class="n">evaluate_command</span><span class="p">[</span><span class="s1">&#39;sessionId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iframe_context</span><span class="o">.</span><span class="n">session_id</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>    <span class="n">evaluate_response</span><span class="p">:</span> <span class="n">EvaluateResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="p">(</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iframe_context</span><span class="o">.</span><span class="n">session_handler</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iframe_context</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>        <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection_handler</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>    <span class="p">)</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">evaluate_command</span><span class="p">)</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>    <span class="n">document_object_id</span> <span class="o">=</span> <span class="n">evaluate_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;objectId&#39;</span><span class="p">)</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iframe_context</span><span class="p">:</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_iframe_context</span><span class="o">.</span><span class="n">document_object_id</span> <span class="o">=</span> <span class="n">document_object_id</span>
</span></code></pre></div>
<hr />
<h2 id="execution-contexts-and-isolated-worlds">Execution Contexts and Isolated Worlds</h2>
<h3 id="what-is-an-execution-context">What is an Execution Context?</h3>
<p>An <strong>execution context</strong> is an environment where JavaScript code is executed. Every frame in a browser has at least one execution context. The context includes:</p>
<ul>
<li><strong>Global object</strong> (<code>window</code> in browsers)</li>
<li><strong>Scope chain</strong>: How variables are resolved</li>
<li><strong>This binding</strong>: What <code>this</code> refers to</li>
<li><strong>Variable environment</strong>: All declared variables and functions</li>
</ul>
<h3 id="multiple-contexts-per-frame">Multiple Contexts per Frame</h3>
<p>A single frame can have multiple execution contexts:</p>
<ol>
<li><strong>Main world (default context)</strong>: Where the page's own JavaScript runs</li>
<li><strong>Isolated worlds</strong>: Separate contexts that share the same DOM but have different JavaScript global scopes</li>
</ol>
<pre class="mermaid"><code>graph TB
    Frame[Frame: example.com/page]
    Frame --&gt; MainWorld[Main World&lt;br/&gt;Page's JavaScript]
    Frame --&gt; IsolatedWorld1[Isolated World 1&lt;br/&gt;Extension content script]
    Frame --&gt; IsolatedWorld2[Isolated World 2&lt;br/&gt;Pydoll automation]

    DOM[Shared DOM Tree]
    MainWorld -.can access.-&gt; DOM
    IsolatedWorld1 -.can access.-&gt; DOM
    IsolatedWorld2 -.can access.-&gt; DOM

    MainWorld -.cannot access.-&gt; IsolatedWorld1
    MainWorld -.cannot access.-&gt; IsolatedWorld2</code></pre>
<h3 id="what-is-an-isolated-world">What is an Isolated World?</h3>
<p>An <strong>isolated world</strong> is a separate JavaScript execution context that:</p>
<ul>
<li><strong>Shares the same DOM</strong>: Can read/modify DOM elements</li>
<li><strong>Has a separate global object</strong>: Variables/functions don't leak between worlds</li>
<li><strong>Prevents interference</strong>: Page scripts cannot detect or interfere with isolated world scripts</li>
</ul>
<p><strong>Origin</strong>: Isolated worlds were created for browser extensions. Content scripts run in isolated worlds so they can interact with the page DOM without:</p>
<ul>
<li>Page scripts overwriting their variables</li>
<li>Being detected by anti-tamper code</li>
<li>Conflicting with page JavaScript</li>
</ul>
<h3 id="why-pydoll-uses-isolated-worlds-for-iframes">Why Pydoll Uses Isolated Worlds for Iframes</h3>
<p>When Pydoll interacts with iframe content, it creates an isolated world in that iframe's context. This provides:</p>
<ol>
<li><strong>Clean JavaScript environment</strong>: No conflicts with iframe's own scripts</li>
<li><strong>Consistent behavior</strong>: Automation scripts work regardless of what JavaScript the iframe runs</li>
<li><strong>Anti-detection</strong>: The iframe's JavaScript cannot easily detect Pydoll's presence</li>
<li><strong>Safe evaluation</strong>: Automation code cannot accidentally trigger page logic</li>
</ol>
<p><strong>Implementation:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># From pydoll/elements/web_element.py</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="nd">@staticmethod</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_create_isolated_world_for_frame</span><span class="p">(</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>    <span class="n">frame_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>    <span class="n">handler</span><span class="p">:</span> <span class="n">ConnectionHandler</span><span class="p">,</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>    <span class="n">session_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create an isolated world (Page.createIsolatedWorld) for the given frame.&quot;&quot;&quot;</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>    <span class="n">create_command</span> <span class="o">=</span> <span class="n">PageCommands</span><span class="o">.</span><span class="n">create_isolated_world</span><span class="p">(</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>        <span class="n">frame_id</span><span class="o">=</span><span class="n">frame_id</span><span class="p">,</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>        <span class="n">world_name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;pydoll::iframe::</span><span class="si">{</span><span class="n">frame_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>        <span class="n">grant_universal_access</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>    <span class="p">)</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>    <span class="k">if</span> <span class="n">session_id</span><span class="p">:</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>        <span class="n">create_command</span><span class="p">[</span><span class="s1">&#39;sessionId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">session_id</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>    <span class="n">create_response</span><span class="p">:</span> <span class="n">CreateIsolatedWorldResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>        <span class="n">create_command</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>    <span class="p">)</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>    <span class="n">execution_context_id</span> <span class="o">=</span> <span class="n">create_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;executionContextId&#39;</span><span class="p">)</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">execution_context_id</span><span class="p">:</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>        <span class="k">raise</span> <span class="n">InvalidIFrame</span><span class="p">(</span><span class="s1">&#39;Unable to create isolated world for iframe&#39;</span><span class="p">)</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>    <span class="k">return</span> <span class="n">execution_context_id</span>
</span></code></pre></div>
<p>The <code>grant_universal_access=True</code> parameter allows the isolated world to:</p>
<ul>
<li>Access cross-origin frames (normally blocked by same-origin policy)</li>
<li>Perform privileged operations needed for automation</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Isolated worlds in practice</p>
<p>Every time you use <code>await iframe.find(...)</code>, Pydoll evaluates the selector query in an isolated world created specifically for that iframe. This ensures your automation logic never conflicts with the iframe's own JavaScript, and the iframe cannot detect or block your automation.</p>
</div>
<hr />
<h2 id="cdp-identifiers-reference">CDP Identifiers Reference</h2>
<p>Understanding CDP identifiers is crucial for iframe handling. Here's a comprehensive reference:</p>
<table>
<thead>
<tr>
<th>Identifier</th>
<th>Domain</th>
<th>Scope</th>
<th>Purpose</th>
<th>Example Use in Pydoll</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>nodeId</code></strong></td>
<td>DOM</td>
<td>Document-local</td>
<td>Identifies a DOM node within a specific document context</td>
<td>Internal CDP operations; not stable across navigations</td>
</tr>
<tr>
<td><strong><code>backendNodeId</code></strong></td>
<td>DOM</td>
<td>Cross-document stable</td>
<td>Stable identifier for a DOM node; can map frames to owner elements</td>
<td>Used to match iframe elements to frame IDs via <code>DOM.getFrameOwner</code></td>
</tr>
<tr>
<td><strong><code>frameId</code></strong></td>
<td>Page</td>
<td>Frame</td>
<td>Identifies a frame in the page's frame tree</td>
<td>Used to specify which frame for <code>Page.createIsolatedWorld</code> and frame tree traversal</td>
</tr>
<tr>
<td><strong><code>targetId</code></strong></td>
<td>Target</td>
<td>Global</td>
<td>Identifies a debugging target (page, iframe, worker, etc.)</td>
<td>Used for <code>Target.attachToTarget</code> to connect to OOPIFs</td>
</tr>
<tr>
<td><strong><code>sessionId</code></strong></td>
<td>Target</td>
<td>Target-specific</td>
<td>Routes commands to a specific target in flattened mode</td>
<td>Injected into commands to route them to the correct OOPIF</td>
</tr>
<tr>
<td><strong><code>executionContextId</code></strong></td>
<td>Runtime</td>
<td>Frame + world</td>
<td>Identifies a JavaScript execution context (including isolated worlds)</td>
<td>Returned by <code>Page.createIsolatedWorld</code>; used in <code>Runtime.evaluate</code></td>
</tr>
<tr>
<td><strong><code>objectId</code></strong></td>
<td>Runtime</td>
<td>Execution context</td>
<td>Remote object reference (e.g., DOM element, function, object)</td>
<td>Reference to iframe's <code>document.documentElement</code> for relative queries</td>
</tr>
</tbody>
</table>
<h3 id="identifier-relationships">Identifier Relationships</h3>
<p>Here's how identifiers relate to each other during iframe resolution:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>┌─────────────────────────────────────────────────────────────────────────┐
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>│                         Resolution Flow                                 │
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>└─────────────────────────────────────────────────────────────────────────┘
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>1. Start: &lt;iframe&gt; Element
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>   └─ backendNodeId: 789
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>2. Find Frame ──────────────[DOM.getFrameOwner]──────────────┐
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>   └─ frameId: abc-123                                       │
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>                                                             │
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>3. OOPIF? Check Origin ─────[Different origin detected]──────┤
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>   └─ targetId: xyz-456                                      │
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>                                                             │
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>4. Attach to Target ────────[Target.attachToTarget]──────────┤
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>   └─ sessionId: session-789                                 │
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>                                                             │
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>5. Create Isolated World ───[Page.createIsolatedWorld]───────┤
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>   └─ executionContextId: 42                                 │
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>                                                             │
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>6. Get Document ────────────[Runtime.evaluate]───────────────┘
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>   └─ objectId: obj-999
</span></code></pre></div>
<p><strong>Key transformation points:</strong></p>
<table>
<thead>
<tr>
<th>From</th>
<th>Method</th>
<th>To</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>backendNodeId</code></td>
<td><code>DOM.getFrameOwner</code></td>
<td><code>frameId</code></td>
<td>Find which frame owns the iframe element</td>
</tr>
<tr>
<td><code>targetId</code></td>
<td><code>Target.attachToTarget(flatten=true)</code></td>
<td><code>sessionId</code></td>
<td>Connect to OOPIF for command routing</td>
</tr>
<tr>
<td><code>frameId</code></td>
<td><code>Page.createIsolatedWorld</code></td>
<td><code>executionContextId</code></td>
<td>Create safe JavaScript environment</td>
</tr>
<tr>
<td><code>executionContextId</code></td>
<td><code>Runtime.evaluate('document.documentElement')</code></td>
<td><code>objectId</code></td>
<td>Get reference to iframe's document</td>
</tr>
</tbody>
</table>
<h3 id="code-representation-in-pydoll">Code Representation in Pydoll</h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># From pydoll/elements/web_element.py</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="nd">@dataclass</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">_IFrameContext</span><span class="p">:</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encapsulates all identifiers and routing information for an iframe.&quot;&quot;&quot;</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>    <span class="n">frame_id</span><span class="p">:</span> <span class="nb">str</span>                                   <span class="c1"># frameId: identifies the frame</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>    <span class="n">document_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>              <span class="c1"># frame&#39;s loaded URL</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>    <span class="n">execution_context_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>      <span class="c1"># executionContextId: isolated world</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>    <span class="n">document_object_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>        <span class="c1"># objectId: document.documentElement</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>    <span class="n">session_handler</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConnectionHandler</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># for OOPIF targets</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>    <span class="n">session_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>                <span class="c1"># sessionId: routes commands to OOPIF</span>
</span></code></pre></div>
<p>This dataclass is cached on each <code>WebElement</code> representing an iframe, enabling automatic routing of all subsequent operations.</p>
<hr />
<h2 id="pydolls-resolution-pipeline">Pydoll's Resolution Pipeline</h2>
<p>When you access an iframe in Pydoll (e.g., <code>await iframe.find(...)</code>), an elaborate resolution pipeline executes behind the scenes. This section breaks down every step.</p>
<h3 id="high-level-flow">High-Level Flow</h3>
<pre class="mermaid"><code>sequenceDiagram
    participant User
    participant WebElement
    participant Pipeline as Resolution Pipeline
    participant CDP

    User-&gt;&gt;WebElement: iframe.find(id='button')
    WebElement-&gt;&gt;WebElement: Check if iframe context cached
    alt Context not cached
        WebElement-&gt;&gt;Pipeline: _ensure_iframe_context()
        Pipeline-&gt;&gt;CDP: DOM.describeNode(iframe)
        CDP--&gt;&gt;Pipeline: Node info (frameId?, backendNodeId, etc.)

        alt frameId not in node info
            Pipeline-&gt;&gt;Pipeline: _resolve_frame_by_owner()
            Pipeline-&gt;&gt;CDP: Page.getFrameTree()
            CDP--&gt;&gt;Pipeline: Frame tree
            Pipeline-&gt;&gt;CDP: DOM.getFrameOwner(each frame)
            CDP--&gt;&gt;Pipeline: backendNodeId
            Pipeline-&gt;&gt;Pipeline: Match backendNodeId to find frameId
        end

        alt frameId still missing (OOPIF)
            Pipeline-&gt;&gt;Pipeline: _resolve_oopif_by_parent()
            Pipeline-&gt;&gt;CDP: Target.getTargets()
            CDP--&gt;&gt;Pipeline: List of targets
            Pipeline-&gt;&gt;CDP: Target.attachToTarget(targetId, flatten=true)
            CDP--&gt;&gt;Pipeline: sessionId
            Pipeline-&gt;&gt;CDP: Page.getFrameTree(sessionId)
            CDP--&gt;&gt;Pipeline: OOPIF frame tree
        end

        Pipeline-&gt;&gt;CDP: Page.createIsolatedWorld(frameId)
        CDP--&gt;&gt;Pipeline: executionContextId

        Pipeline-&gt;&gt;CDP: Runtime.evaluate('document.documentElement', contextId)
        CDP--&gt;&gt;Pipeline: objectId (document reference)

        Pipeline-&gt;&gt;WebElement: Cache _IFrameContext
    end

    WebElement-&gt;&gt;WebElement: Use cached context for find()
    WebElement--&gt;&gt;User: Button element (with context)</code></pre>
<h3 id="step-by-step-deep-dive">Step-by-Step Deep Dive</h3>
<h4 id="step-1-describe-the-iframe-element"><strong>Step 1: Describe the Iframe Element</strong></h4>
<p><strong>Goal</strong>: Extract metadata from the <code>&lt;iframe&gt;</code> DOM element.</p>
<p><strong>Method</strong>: <code>DOM.describeNode(objectId=iframe_object_id)</code></p>
<p><strong>What we get</strong>:</p>
<ul>
<li><code>backendNodeId</code>: Stable identifier for the iframe element</li>
<li><code>frameId</code> (from <code>contentDocument</code>): If the iframe's content is already loaded and in-process</li>
<li><code>documentURL</code>: The URL loaded in the iframe</li>
<li><code>parentFrameId</code> (from <code>frameId</code> field on the node): The frame containing this iframe element</li>
</ul>
<p><strong>Code</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># From pydoll/elements/web_element.py</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_ensure_iframe_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize and cache context information for iframe elements.&quot;&quot;&quot;</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>    <span class="n">node_info</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_describe_node</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_object_id</span><span class="p">)</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>    <span class="n">base_handler</span><span class="p">,</span> <span class="n">base_session_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_base_session</span><span class="p">()</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    <span class="n">frame_id</span><span class="p">,</span> <span class="n">document_url</span><span class="p">,</span> <span class="n">parent_frame_id</span><span class="p">,</span> <span class="n">backend_node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_frame_metadata</span><span class="p">(</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>        <span class="n">node_info</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>    <span class="p">)</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>    <span class="c1"># ... continue resolution</span>
</span></code></pre></div>
<p><strong>Helper</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nd">@staticmethod</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">_extract_frame_metadata</span><span class="p">(</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>    <span class="n">node_info</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract iframe-related metadata from a DOM.describeNode Node.&quot;&quot;&quot;</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>    <span class="n">content_document</span> <span class="o">=</span> <span class="n">node_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;contentDocument&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>    <span class="n">parent_frame_id</span> <span class="o">=</span> <span class="n">node_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;frameId&#39;</span><span class="p">)</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>    <span class="n">backend_node_id</span> <span class="o">=</span> <span class="n">node_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;backendNodeId&#39;</span><span class="p">)</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>    <span class="n">frame_id</span> <span class="o">=</span> <span class="n">content_document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;frameId&#39;</span><span class="p">)</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>    <span class="n">document_url</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>        <span class="n">content_document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;documentURL&#39;</span><span class="p">)</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>        <span class="ow">or</span> <span class="n">content_document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;baseURL&#39;</span><span class="p">)</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>        <span class="ow">or</span> <span class="n">node_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;documentURL&#39;</span><span class="p">)</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>        <span class="ow">or</span> <span class="n">node_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;baseURL&#39;</span><span class="p">)</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>    <span class="p">)</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>    <span class="k">return</span> <span class="n">frame_id</span><span class="p">,</span> <span class="n">document_url</span><span class="p">,</span> <span class="n">parent_frame_id</span><span class="p">,</span> <span class="n">backend_node_id</span>
</span></code></pre></div>
<p><strong>Outcome</strong>:</p>
<ul>
<li><strong>If <code>frame_id</code> is present</strong>: Great! The iframe is in-process; proceed to Step 4.</li>
<li><strong>If <code>frame_id</code> is missing</strong>: The iframe might be an OOPIF or not fully loaded; proceed to Step 2.</li>
</ul>
<hr />
<h4 id="step-2-resolve-frame-by-owner-backendnodeid-matching"><strong>Step 2: Resolve Frame by Owner (backendNodeId matching)</strong></h4>
<p><strong>Goal</strong>: Find the <code>frameId</code> by matching the iframe element's <code>backendNodeId</code> to frame owners in the frame tree.</p>
<p><strong>Strategy</strong>:</p>
<ol>
<li>Fetch the page's frame tree (<code>Page.getFrameTree</code>)</li>
<li>For each frame in the tree, call <code>DOM.getFrameOwner(frameId)</code> to get the <code>backendNodeId</code> of the owning iframe element</li>
<li>Compare with our iframe's <code>backendNodeId</code></li>
<li>When they match, we've found the correct <code>frameId</code></li>
</ol>
<p><strong>Code</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># From pydoll/elements/web_element.py</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_resolve_frame_by_owner</span><span class="p">(</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>    <span class="n">base_handler</span><span class="p">:</span> <span class="n">ConnectionHandler</span><span class="p">,</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>    <span class="n">base_session_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>    <span class="n">backend_node_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>    <span class="n">current_document_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Resolve a frame id and URL by matching the owner backend_node_id.&quot;&quot;&quot;</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>    <span class="n">owner_frame_id</span><span class="p">,</span> <span class="n">owner_url</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_frame_by_owner</span><span class="p">(</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>        <span class="n">base_handler</span><span class="p">,</span> <span class="n">base_session_id</span><span class="p">,</span> <span class="n">backend_node_id</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>    <span class="p">)</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">owner_frame_id</span><span class="p">:</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">current_document_url</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>    <span class="k">return</span> <span class="n">owner_frame_id</span><span class="p">,</span> <span class="n">owner_url</span> <span class="ow">or</span> <span class="n">current_document_url</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_find_frame_by_owner</span><span class="p">(</span>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">ConnectionHandler</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">backend_node_id</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find a frame by matching the owner backend_node_id of the &lt;iframe&gt; element.&quot;&quot;&quot;</span>
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a>    <span class="n">frame_tree</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_frame_tree_for</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">session_id</span><span class="p">)</span>
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>    <span class="k">for</span> <span class="n">frame_node</span> <span class="ow">in</span> <span class="n">WebElement</span><span class="o">.</span><span class="n">_walk_frames</span><span class="p">(</span><span class="n">frame_tree</span><span class="p">):</span>
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>        <span class="n">candidate_frame_id</span> <span class="o">=</span> <span class="n">frame_node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">candidate_frame_id</span><span class="p">:</span>
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a>            <span class="k">continue</span>
</span><span id="__span-17-26"><a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a>        <span class="n">owner_backend_id</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner_backend_for</span><span class="p">(</span>
</span><span id="__span-17-27"><a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a>            <span class="n">handler</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">candidate_frame_id</span>
</span><span id="__span-17-28"><a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a>        <span class="p">)</span>
</span><span id="__span-17-29"><a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a>        <span class="k">if</span> <span class="n">owner_backend_id</span> <span class="o">==</span> <span class="n">backend_node_id</span><span class="p">:</span>
</span><span id="__span-17-30"><a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a>            <span class="k">return</span> <span class="n">candidate_frame_id</span><span class="p">,</span> <span class="n">frame_node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">)</span>
</span><span id="__span-17-31"><a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a>    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span></code></pre></div>
<p><strong>Why this is necessary</strong>:</p>
<ul>
<li><code>DOM.describeNode</code> sometimes doesn't include the <code>contentDocument.frameId</code> for cross-origin or lazy-loaded iframes</li>
<li>The frame tree always contains all frames (even OOPIFs), so we can find it indirectly</li>
</ul>
<p><strong>Outcome</strong>:</p>
<ul>
<li><strong>If <code>frameId</code> found</strong>: Proceed to Step 4.</li>
<li><strong>If still not found</strong>: The iframe is likely an OOPIF in a separate target; proceed to Step 3.</li>
</ul>
<hr />
<h4 id="step-3-resolve-oopif-by-parent-frame"><strong>Step 3: Resolve OOPIF by Parent Frame</strong></h4>
<p><strong>Goal</strong>: For Out-of-Process Iframes, find the correct target, attach to it, and obtain the <code>frameId</code> from the target's frame tree (and the routing <code>sessionId</code> when needed).</p>
<p><strong>When this runs</strong>:</p>
<ul>
<li>Same-origin / in-process iframes that already have a <code>frameId</code> and <strong>no</strong> <code>backendNodeId</code> skip this step (they are handled directly).</li>
<li>Cross-origin / OOPIF iframes (with <code>backendNodeId</code>) or iframes whose <code>frameId</code> could not be resolved via Step 2 use this step.</li>
</ul>
<p><strong>Strategy</strong>:</p>
<p><strong>3a. Direct child target lookup (fast path)</strong>:</p>
<ol>
<li>Call <code>Target.getTargets()</code> to list all debugging targets.</li>
<li>Filter targets where <code>type</code> is <code>"iframe"</code> or <code>"page"</code> and <code>parentFrameId</code> matches our parent frame.</li>
<li>If there is <strong>exactly one</strong> matching child <strong>and we don't have a <code>backendNodeId</code></strong>, attach directly to that target with <code>Target.attachToTarget(targetId, flatten=true)</code>.</li>
<li>Fetch <code>Page.getFrameTree(sessionId)</code> for that target; the root frame of this tree is our iframe's frame.</li>
</ol>
<p>When there are <strong>multiple</strong> direct children or we have a <code>backendNodeId</code> (typical OOPIF case), Pydoll iterates over each child target:</p>
<ol>
<li>Attach via <code>Target.attachToTarget(flatten=true)</code>.</li>
<li>Fetch <code>Page.getFrameTree(sessionId)</code> and read the root <code>frame.id</code>.</li>
<li>Call <code>DOM.getFrameOwner(frameId=root_id)</code> on the <strong>main</strong> connection.</li>
<li>Compare the returned <code>backendNodeId</code> with our iframe element's <code>backendNodeId</code>.</li>
<li>The child whose root owner matches is selected as the correct OOPIF target.</li>
</ol>
<p><strong>3b. Fallback: Scan all targets (root owner + child search)</strong>:</p>
<p>If no suitable direct child is found (or when <code>parentFrameId</code> information is incomplete), Pydoll falls back to scanning <strong>all</strong> iframe/page targets:</p>
<ol>
<li>Iterate all iframe/page targets.</li>
<li>Attach to each and fetch its frame tree.</li>
<li>First, try to match the <strong>root frame owner</strong> via <code>DOM.getFrameOwner(root_frame_id)</code> against our iframe's <code>backendNodeId</code>.</li>
<li>If that does not match, look for a <strong>child frame</strong> whose <code>parentId</code> equals our <code>parent_frame_id</code> (this covers cases where the OOPIF is nested under an intermediate frame).</li>
</ol>
<p><strong>Code</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># From pydoll/elements/web_element.py</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_resolve_oopif_by_parent</span><span class="p">(</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>    <span class="n">parent_frame_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>    <span class="n">backend_node_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ConnectionHandler</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Resolve an OOPIF using the given parent frame id.&quot;&quot;&quot;</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>    <span class="n">browser_handler</span> <span class="o">=</span> <span class="n">ConnectionHandler</span><span class="p">(</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>        <span class="n">connection_port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection_handler</span><span class="o">.</span><span class="n">_connection_port</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>    <span class="p">)</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>    <span class="n">targets_response</span><span class="p">:</span> <span class="n">GetTargetsResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="n">browser_handler</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>        <span class="n">TargetCommands</span><span class="o">.</span><span class="n">get_targets</span><span class="p">()</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>    <span class="p">)</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>    <span class="n">target_infos</span> <span class="o">=</span> <span class="n">targets_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;targetInfos&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>    <span class="c1"># Strategy 3a: Direct children (fast path)</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>    <span class="n">direct_children</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>        <span class="n">target_info</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>        <span class="k">for</span> <span class="n">target_info</span> <span class="ow">in</span> <span class="n">target_infos</span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>        <span class="k">if</span> <span class="n">target_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;iframe&#39;</span><span class="p">,</span> <span class="s1">&#39;page&#39;</span><span class="p">}</span>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>        <span class="ow">and</span> <span class="n">target_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parentFrameId&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">parent_frame_id</span>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a>    <span class="p">]</span>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>    <span class="n">is_single_child</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">direct_children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a>    <span class="k">for</span> <span class="n">child_target</span> <span class="ow">in</span> <span class="n">direct_children</span><span class="p">:</span>
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a>        <span class="n">attach_response</span><span class="p">:</span> <span class="n">AttachToTargetResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="n">browser_handler</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span>
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a>            <span class="n">TargetCommands</span><span class="o">.</span><span class="n">attach_to_target</span><span class="p">(</span>
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a>                <span class="n">target_id</span><span class="o">=</span><span class="n">child_target</span><span class="p">[</span><span class="s1">&#39;targetId&#39;</span><span class="p">],</span> <span class="n">flatten</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-18-29"><a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a>            <span class="p">)</span>
</span><span id="__span-18-30"><a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a>        <span class="p">)</span>
</span><span id="__span-18-31"><a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a>        <span class="n">attached_session_id</span> <span class="o">=</span> <span class="n">attach_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sessionId&#39;</span><span class="p">)</span>
</span><span id="__span-18-32"><a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">attached_session_id</span><span class="p">:</span>
</span><span id="__span-18-33"><a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a>            <span class="k">continue</span>
</span><span id="__span-18-34"><a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a>
</span><span id="__span-18-35"><a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a>        <span class="n">frame_tree</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_frame_tree_for</span><span class="p">(</span><span class="n">browser_handler</span><span class="p">,</span> <span class="n">attached_session_id</span><span class="p">)</span>
</span><span id="__span-18-36"><a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a>        <span class="n">root_frame</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_tree</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;frame&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-18-37"><a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a>        <span class="n">root_frame_id</span> <span class="o">=</span> <span class="n">root_frame</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-18-38"><a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a>
</span><span id="__span-18-39"><a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a>        <span class="c1"># Same-origin / simple case: single child and no backend_node_id</span>
</span><span id="__span-18-40"><a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a>        <span class="k">if</span> <span class="n">is_single_child</span> <span class="ow">and</span> <span class="n">root_frame_id</span> <span class="ow">and</span> <span class="n">backend_node_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-18-41"><a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a>            <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-18-42"><a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a>                <span class="n">browser_handler</span><span class="p">,</span>
</span><span id="__span-18-43"><a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a>                <span class="n">attached_session_id</span><span class="p">,</span>
</span><span id="__span-18-44"><a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a>                <span class="n">root_frame_id</span><span class="p">,</span>
</span><span id="__span-18-45"><a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a>                <span class="n">root_frame</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">),</span>
</span><span id="__span-18-46"><a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a>            <span class="p">)</span>
</span><span id="__span-18-47"><a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a>
</span><span id="__span-18-48"><a id="__codelineno-18-48" name="__codelineno-18-48" href="#__codelineno-18-48"></a>        <span class="c1"># OOPIF case: confirm ownership via DOM.getFrameOwner</span>
</span><span id="__span-18-49"><a id="__codelineno-18-49" name="__codelineno-18-49" href="#__codelineno-18-49"></a>        <span class="k">if</span> <span class="n">root_frame_id</span> <span class="ow">and</span> <span class="n">backend_node_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-18-50"><a id="__codelineno-18-50" name="__codelineno-18-50" href="#__codelineno-18-50"></a>            <span class="n">owner_backend_id</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner_backend_for</span><span class="p">(</span>
</span><span id="__span-18-51"><a id="__codelineno-18-51" name="__codelineno-18-51" href="#__codelineno-18-51"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_connection_handler</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">root_frame_id</span>
</span><span id="__span-18-52"><a id="__codelineno-18-52" name="__codelineno-18-52" href="#__codelineno-18-52"></a>            <span class="p">)</span>
</span><span id="__span-18-53"><a id="__codelineno-18-53" name="__codelineno-18-53" href="#__codelineno-18-53"></a>            <span class="k">if</span> <span class="n">owner_backend_id</span> <span class="o">==</span> <span class="n">backend_node_id</span><span class="p">:</span>
</span><span id="__span-18-54"><a id="__codelineno-18-54" name="__codelineno-18-54" href="#__codelineno-18-54"></a>                <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-18-55"><a id="__codelineno-18-55" name="__codelineno-18-55" href="#__codelineno-18-55"></a>                    <span class="n">browser_handler</span><span class="p">,</span>
</span><span id="__span-18-56"><a id="__codelineno-18-56" name="__codelineno-18-56" href="#__codelineno-18-56"></a>                    <span class="n">attached_session_id</span><span class="p">,</span>
</span><span id="__span-18-57"><a id="__codelineno-18-57" name="__codelineno-18-57" href="#__codelineno-18-57"></a>                    <span class="n">root_frame_id</span><span class="p">,</span>
</span><span id="__span-18-58"><a id="__codelineno-18-58" name="__codelineno-18-58" href="#__codelineno-18-58"></a>                    <span class="n">root_frame</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">),</span>
</span><span id="__span-18-59"><a id="__codelineno-18-59" name="__codelineno-18-59" href="#__codelineno-18-59"></a>                <span class="p">)</span>
</span><span id="__span-18-60"><a id="__codelineno-18-60" name="__codelineno-18-60" href="#__codelineno-18-60"></a>
</span><span id="__span-18-61"><a id="__codelineno-18-61" name="__codelineno-18-61" href="#__codelineno-18-61"></a>    <span class="c1"># Strategy 3b: Scan all targets (root owner + child search)</span>
</span><span id="__span-18-62"><a id="__codelineno-18-62" name="__codelineno-18-62" href="#__codelineno-18-62"></a>    <span class="k">for</span> <span class="n">target_info</span> <span class="ow">in</span> <span class="n">target_infos</span><span class="p">:</span>
</span><span id="__span-18-63"><a id="__codelineno-18-63" name="__codelineno-18-63" href="#__codelineno-18-63"></a>        <span class="k">if</span> <span class="n">target_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;iframe&#39;</span><span class="p">,</span> <span class="s1">&#39;page&#39;</span><span class="p">}:</span>
</span><span id="__span-18-64"><a id="__codelineno-18-64" name="__codelineno-18-64" href="#__codelineno-18-64"></a>            <span class="k">continue</span>
</span><span id="__span-18-65"><a id="__codelineno-18-65" name="__codelineno-18-65" href="#__codelineno-18-65"></a>        <span class="n">attach_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">browser_handler</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span>
</span><span id="__span-18-66"><a id="__codelineno-18-66" name="__codelineno-18-66" href="#__codelineno-18-66"></a>            <span class="n">TargetCommands</span><span class="o">.</span><span class="n">attach_to_target</span><span class="p">(</span>
</span><span id="__span-18-67"><a id="__codelineno-18-67" name="__codelineno-18-67" href="#__codelineno-18-67"></a>                <span class="n">target_id</span><span class="o">=</span><span class="n">target_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;targetId&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">flatten</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-18-68"><a id="__codelineno-18-68" name="__codelineno-18-68" href="#__codelineno-18-68"></a>            <span class="p">)</span>
</span><span id="__span-18-69"><a id="__codelineno-18-69" name="__codelineno-18-69" href="#__codelineno-18-69"></a>        <span class="p">)</span>
</span><span id="__span-18-70"><a id="__codelineno-18-70" name="__codelineno-18-70" href="#__codelineno-18-70"></a>        <span class="n">attached_session_id</span> <span class="o">=</span> <span class="n">attach_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sessionId&#39;</span><span class="p">)</span>
</span><span id="__span-18-71"><a id="__codelineno-18-71" name="__codelineno-18-71" href="#__codelineno-18-71"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">attached_session_id</span><span class="p">:</span>
</span><span id="__span-18-72"><a id="__codelineno-18-72" name="__codelineno-18-72" href="#__codelineno-18-72"></a>            <span class="k">continue</span>
</span><span id="__span-18-73"><a id="__codelineno-18-73" name="__codelineno-18-73" href="#__codelineno-18-73"></a>
</span><span id="__span-18-74"><a id="__codelineno-18-74" name="__codelineno-18-74" href="#__codelineno-18-74"></a>        <span class="n">frame_tree</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_frame_tree_for</span><span class="p">(</span><span class="n">browser_handler</span><span class="p">,</span> <span class="n">attached_session_id</span><span class="p">)</span>
</span><span id="__span-18-75"><a id="__codelineno-18-75" name="__codelineno-18-75" href="#__codelineno-18-75"></a>        <span class="n">root_frame</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_tree</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;frame&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-18-76"><a id="__codelineno-18-76" name="__codelineno-18-76" href="#__codelineno-18-76"></a>        <span class="n">root_frame_id</span> <span class="o">=</span> <span class="n">root_frame</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="__span-18-77"><a id="__codelineno-18-77" name="__codelineno-18-77" href="#__codelineno-18-77"></a>
</span><span id="__span-18-78"><a id="__codelineno-18-78" name="__codelineno-18-78" href="#__codelineno-18-78"></a>        <span class="c1"># Try matching root owner by backend_node_id</span>
</span><span id="__span-18-79"><a id="__codelineno-18-79" name="__codelineno-18-79" href="#__codelineno-18-79"></a>        <span class="k">if</span> <span class="n">root_frame_id</span> <span class="ow">and</span> <span class="n">backend_node_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-18-80"><a id="__codelineno-18-80" name="__codelineno-18-80" href="#__codelineno-18-80"></a>            <span class="n">owner_backend_id</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner_backend_for</span><span class="p">(</span>
</span><span id="__span-18-81"><a id="__codelineno-18-81" name="__codelineno-18-81" href="#__codelineno-18-81"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_connection_handler</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">root_frame_id</span>
</span><span id="__span-18-82"><a id="__codelineno-18-82" name="__codelineno-18-82" href="#__codelineno-18-82"></a>            <span class="p">)</span>
</span><span id="__span-18-83"><a id="__codelineno-18-83" name="__codelineno-18-83" href="#__codelineno-18-83"></a>            <span class="k">if</span> <span class="n">owner_backend_id</span> <span class="o">==</span> <span class="n">backend_node_id</span><span class="p">:</span>
</span><span id="__span-18-84"><a id="__codelineno-18-84" name="__codelineno-18-84" href="#__codelineno-18-84"></a>                <span class="k">return</span> <span class="p">(</span>
</span><span id="__span-18-85"><a id="__codelineno-18-85" name="__codelineno-18-85" href="#__codelineno-18-85"></a>                    <span class="n">browser_handler</span><span class="p">,</span>
</span><span id="__span-18-86"><a id="__codelineno-18-86" name="__codelineno-18-86" href="#__codelineno-18-86"></a>                    <span class="n">attached_session_id</span><span class="p">,</span>
</span><span id="__span-18-87"><a id="__codelineno-18-87" name="__codelineno-18-87" href="#__codelineno-18-87"></a>                    <span class="n">root_frame_id</span><span class="p">,</span>
</span><span id="__span-18-88"><a id="__codelineno-18-88" name="__codelineno-18-88" href="#__codelineno-18-88"></a>                    <span class="n">root_frame</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">),</span>
</span><span id="__span-18-89"><a id="__codelineno-18-89" name="__codelineno-18-89" href="#__codelineno-18-89"></a>                <span class="p">)</span>
</span><span id="__span-18-90"><a id="__codelineno-18-90" name="__codelineno-18-90" href="#__codelineno-18-90"></a>
</span><span id="__span-18-91"><a id="__codelineno-18-91" name="__codelineno-18-91" href="#__codelineno-18-91"></a>        <span class="c1"># Fallback: match a child frame whose parentId equals parent_frame_id</span>
</span><span id="__span-18-92"><a id="__codelineno-18-92" name="__codelineno-18-92" href="#__codelineno-18-92"></a>        <span class="n">child_frame_id</span> <span class="o">=</span> <span class="n">WebElement</span><span class="o">.</span><span class="n">_find_child_by_parent</span><span class="p">(</span><span class="n">frame_tree</span><span class="p">,</span> <span class="n">parent_frame_id</span><span class="p">)</span>
</span><span id="__span-18-93"><a id="__codelineno-18-93" name="__codelineno-18-93" href="#__codelineno-18-93"></a>        <span class="k">if</span> <span class="n">child_frame_id</span><span class="p">:</span>
</span><span id="__span-18-94"><a id="__codelineno-18-94" name="__codelineno-18-94" href="#__codelineno-18-94"></a>            <span class="k">return</span> <span class="n">browser_handler</span><span class="p">,</span> <span class="n">attached_session_id</span><span class="p">,</span> <span class="n">child_frame_id</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="__span-18-95"><a id="__codelineno-18-95" name="__codelineno-18-95" href="#__codelineno-18-95"></a>
</span><span id="__span-18-96"><a id="__codelineno-18-96" name="__codelineno-18-96" href="#__codelineno-18-96"></a>    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span></code></pre></div>
<p><strong>Outcome</strong>:</p>
<ul>
<li><strong>If OOPIF resolved</strong>: We now have <code>sessionId</code>, <code>session_handler</code>, and <code>frameId</code>; proceed to Step 4.</li>
<li><strong>If resolution fails</strong>: Raise <code>InvalidIFrame</code> exception (handled in <code>_ensure_iframe_context</code>).</li>
</ul>
<hr />
<h4 id="step-4-create-isolated-world"><strong>Step 4: Create Isolated World</strong></h4>
<p><strong>Goal</strong>: Create a separate JavaScript execution context in the resolved frame.</p>
<p><strong>Method</strong>: <code>Page.createIsolatedWorld(frameId, worldName='pydoll::iframe::&lt;frameId&gt;', grantUniversalAccess=true)</code></p>
<p><strong>Parameters</strong>:
- <code>frameId</code>: The frame where the isolated world is created
- <code>worldName</code>: Identifier for the world (useful for debugging)
- <code>grantUniversalAccess</code>: Allows cross-origin access (needed for automation)</p>
<p><strong>Response</strong>: <code>{ executionContextId: 42 }</code></p>
<p><strong>Code</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># From pydoll/elements/web_element.py</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="nd">@staticmethod</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_create_isolated_world_for_frame</span><span class="p">(</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>    <span class="n">frame_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>    <span class="n">handler</span><span class="p">:</span> <span class="n">ConnectionHandler</span><span class="p">,</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>    <span class="n">session_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create an isolated world for the given frame.&quot;&quot;&quot;</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>    <span class="n">create_command</span> <span class="o">=</span> <span class="n">PageCommands</span><span class="o">.</span><span class="n">create_isolated_world</span><span class="p">(</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>        <span class="n">frame_id</span><span class="o">=</span><span class="n">frame_id</span><span class="p">,</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>        <span class="n">world_name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;pydoll::iframe::</span><span class="si">{</span><span class="n">frame_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>        <span class="n">grant_universal_access</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>    <span class="p">)</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>    <span class="k">if</span> <span class="n">session_id</span><span class="p">:</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>        <span class="n">create_command</span><span class="p">[</span><span class="s1">&#39;sessionId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">session_id</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>    <span class="n">create_response</span><span class="p">:</span> <span class="n">CreateIsolatedWorldResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">create_command</span><span class="p">)</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>    <span class="n">execution_context_id</span> <span class="o">=</span> <span class="n">create_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;executionContextId&#39;</span><span class="p">)</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">execution_context_id</span><span class="p">:</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>        <span class="k">raise</span> <span class="n">InvalidIFrame</span><span class="p">(</span><span class="s1">&#39;Unable to create isolated world for iframe&#39;</span><span class="p">)</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>    <span class="k">return</span> <span class="n">execution_context_id</span>
</span></code></pre></div>
<p><strong>Why isolated world</strong>:</p>
<ul>
<li><strong>Isolation</strong>: Our automation JavaScript doesn't interfere with the iframe's JavaScript</li>
<li><strong>Anti-detection</strong>: The iframe cannot detect our presence easily</li>
<li><strong>Consistency</strong>: Behavior is predictable regardless of iframe's script environment</li>
</ul>
<p><strong>Outcome</strong>: We have an <code>executionContextId</code> for running JavaScript in the iframe.</p>
<hr />
<h4 id="step-5-pin-the-iframe-document-as-a-runtime-object"><strong>Step 5: Pin the Iframe Document as a Runtime Object</strong></h4>
<p><strong>Goal</strong>: Obtain an <code>objectId</code> reference to the iframe's <code>document.documentElement</code> (the <code>&lt;html&gt;</code> element of the iframe).</p>
<p><strong>Method</strong>: <code>Runtime.evaluate(expression='document.documentElement', contextId=executionContextId)</code></p>
<p><strong>Why we need this</strong>:</p>
<ul>
<li>To execute <strong>relative queries</strong> (like <code>element.querySelector()</code>) inside the iframe</li>
<li>The <code>objectId</code> allows using <code>Runtime.callFunctionOn(objectId, ...)</code> with <code>this</code> bound to the iframe's document</li>
</ul>
<p><strong>Code</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># From pydoll/elements/web_element.py</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_set_iframe_document_object_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">execution_context_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate document.documentElement in the iframe context and cache its object id.&quot;&quot;&quot;</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>    <span class="n">evaluate_command</span> <span class="o">=</span> <span class="n">RuntimeCommands</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>        <span class="n">expression</span><span class="o">=</span><span class="s1">&#39;document.documentElement&#39;</span><span class="p">,</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>        <span class="n">context_id</span><span class="o">=</span><span class="n">execution_context_id</span><span class="p">,</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>    <span class="p">)</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iframe_context</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iframe_context</span><span class="o">.</span><span class="n">session_id</span><span class="p">:</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>        <span class="n">evaluate_command</span><span class="p">[</span><span class="s1">&#39;sessionId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iframe_context</span><span class="o">.</span><span class="n">session_id</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>    <span class="n">evaluate_response</span><span class="p">:</span> <span class="n">EvaluateResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="p">(</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iframe_context</span><span class="o">.</span><span class="n">session_handler</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iframe_context</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>        <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection_handler</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>    <span class="p">)</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">evaluate_command</span><span class="p">)</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>    <span class="n">result_object</span> <span class="o">=</span> <span class="n">evaluate_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>    <span class="n">document_object_id</span> <span class="o">=</span> <span class="n">result_object</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;objectId&#39;</span><span class="p">)</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">document_object_id</span><span class="p">:</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>        <span class="k">raise</span> <span class="n">InvalidIFrame</span><span class="p">(</span><span class="s1">&#39;Unable to obtain document reference for iframe&#39;</span><span class="p">)</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iframe_context</span><span class="p">:</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_iframe_context</span><span class="o">.</span><span class="n">document_object_id</span> <span class="o">=</span> <span class="n">document_object_id</span>
</span></code></pre></div>
<p><strong>Outcome</strong>: The <code>_IFrameContext</code> is now fully populated and cached on the <code>WebElement</code>.</p>
<hr />
<h4 id="step-6-cache-and-propagate-context"><strong>Step 6: Cache and Propagate Context</strong></h4>
<p><strong>Goal</strong>: Store the resolved context on the iframe element and propagate it to all child elements found within the iframe.</p>
<p><strong>Caching</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># From pydoll/elements/web_element.py</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">_init_iframe_context</span><span class="p">(</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>    <span class="n">frame_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>    <span class="n">document_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>    <span class="n">session_handler</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ConnectionHandler</span><span class="p">],</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>    <span class="n">session_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize and cache iframe context on this element.&quot;&quot;&quot;</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_iframe_context</span> <span class="o">=</span> <span class="n">_IFrameContext</span><span class="p">(</span><span class="n">frame_id</span><span class="o">=</span><span class="n">frame_id</span><span class="p">,</span> <span class="n">document_url</span><span class="o">=</span><span class="n">document_url</span><span class="p">)</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>    <span class="c1"># Clean up routing attributes (these were for nested iframes)</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_routing_session_handler&#39;</span><span class="p">):</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>        <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_routing_session_handler&#39;</span><span class="p">)</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_routing_session_id&#39;</span><span class="p">):</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>        <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_routing_session_id&#39;</span><span class="p">)</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>    <span class="c1"># Store OOPIF routing if needed</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>    <span class="k">if</span> <span class="n">session_handler</span> <span class="ow">and</span> <span class="n">session_id</span><span class="p">:</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_iframe_context</span><span class="o">.</span><span class="n">session_handler</span> <span class="o">=</span> <span class="n">session_handler</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_iframe_context</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">session_id</span>
</span></code></pre></div>
<p><strong>Propagation</strong> (when finding elements inside the iframe):</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># From pydoll/elements/mixins/find_elements_mixin.py</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">_apply_iframe_context_to_element</span><span class="p">(</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="n">WebElement</span><span class="p">,</span> <span class="n">iframe_context</span><span class="p">:</span> <span class="n">_IFrameContext</span> <span class="o">|</span> <span class="kc">None</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Propagate iframe context to the newly created element.&quot;&quot;&quot;</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">iframe_context</span><span class="p">:</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>        <span class="k">return</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>    <span class="c1"># If the child element is also an iframe, set up routing</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="s1">&#39;is_iframe&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>        <span class="n">element</span><span class="o">.</span><span class="n">_routing_session_handler</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>            <span class="n">iframe_context</span><span class="o">.</span><span class="n">session_handler</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection_handler</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>        <span class="p">)</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>        <span class="n">element</span><span class="o">.</span><span class="n">_routing_session_id</span> <span class="o">=</span> <span class="n">iframe_context</span><span class="o">.</span><span class="n">session_id</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>        <span class="n">element</span><span class="o">.</span><span class="n">_routing_parent_frame_id</span> <span class="o">=</span> <span class="n">iframe_context</span><span class="o">.</span><span class="n">frame_id</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>        <span class="k">return</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>    <span class="c1"># Otherwise, inject the parent iframe&#39;s context</span>
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>    <span class="n">element</span><span class="o">.</span><span class="n">_iframe_context</span> <span class="o">=</span> <span class="n">iframe_context</span>
</span></code></pre></div>
<p><strong>Why propagation matters</strong>:</p>
<ul>
<li>Elements found inside an iframe inherit the iframe's context</li>
<li>This ensures subsequent operations (click, type, find nested elements) automatically use the correct routing</li>
<li>Nested iframes receive routing information so they can resolve their own context relative to the parent iframe</li>
</ul>
<hr />
<h2 id="session-routing-and-flattened-mode">Session Routing and Flattened Mode</h2>
<h3 id="the-flattened-session-model">The Flattened Session Model</h3>
<p>As discussed in <a href="../cdp/">Deep Dive → Fundamentals → CDP</a>, traditional CDP uses separate WebSocket connections for each target. <strong>Flattened mode</strong> is an optimization where all targets share a single WebSocket connection, with commands routed using a <code>sessionId</code>.</p>
<pre class="mermaid"><code>graph TB
    subgraph "Traditional Mode"
        WS1[WebSocket 1] --&gt; MainPage[Main Page Target]
        WS2[WebSocket 2] --&gt; Iframe1[OOPIF Target 1]
        WS3[WebSocket 3] --&gt; Iframe2[OOPIF Target 2]
    end

    subgraph "Flattened Mode"
        WS[Single WebSocket] --&gt; Router{CDP Router}
        Router --&gt;|sessionId: null| MainPage2[Main Page Target]
        Router --&gt;|sessionId: session-1| Iframe3[OOPIF Target 1]
        Router --&gt;|sessionId: session-2| Iframe4[OOPIF Target 2]
    end</code></pre>
<h3 id="how-session-routing-works">How Session Routing Works</h3>
<p><strong>When attaching to an OOPIF</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>    <span class="n">TargetCommands</span><span class="o">.</span><span class="n">attach_to_target</span><span class="p">(</span><span class="n">targetId</span><span class="o">=</span><span class="s2">&quot;iframe-target-id&quot;</span><span class="p">,</span> <span class="n">flatten</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="p">)</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="n">session_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">][</span><span class="s1">&#39;sessionId&#39;</span><span class="p">]</span>  <span class="c1"># e.g., &quot;8E6C...-1234&quot;</span>
</span></code></pre></div>
<p><strong>When sending a command to that OOPIF</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">command</span> <span class="o">=</span> <span class="n">PageCommands</span><span class="o">.</span><span class="n">get_frame_tree</span><span class="p">()</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">command</span><span class="p">[</span><span class="s1">&#39;sessionId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;session-1&#39;</span>  <span class="c1"># Route to the OOPIF</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span></code></pre></div>
<p>The browser's CDP implementation routes the command to the correct target based on the <code>sessionId</code>.</p>
<h3 id="pydolls-command-routing">Pydoll's Command Routing</h3>
<p>Every command sent by Pydoll elements is automatically routed to the correct target:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># From pydoll/elements/mixins/find_elements_mixin.py</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">_resolve_routing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">ConnectionHandler</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Resolve handler and sessionId for the current context.&quot;&quot;&quot;</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>    <span class="c1"># Check if element has an iframe context with OOPIF routing</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>    <span class="n">iframe_context</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_iframe_context&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>    <span class="k">if</span> <span class="n">iframe_context</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">iframe_context</span><span class="p">,</span> <span class="s1">&#39;session_handler&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>        <span class="k">return</span> <span class="n">iframe_context</span><span class="o">.</span><span class="n">session_handler</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">iframe_context</span><span class="p">,</span> <span class="s1">&#39;session_id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>    <span class="c1"># Check if element has inherited routing from a parent iframe</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>    <span class="n">routing_handler</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_routing_session_handler&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>    <span class="k">if</span> <span class="n">routing_handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>        <span class="k">return</span> <span class="n">routing_handler</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_routing_session_id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a>    <span class="c1"># Default: use the tab&#39;s main connection</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection_handler</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_execute_command</span><span class="p">(</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">Command</span><span class="p">[</span><span class="n">T_CommandParams</span><span class="p">,</span> <span class="n">T_CommandResponse</span><span class="p">]</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_CommandResponse</span><span class="p">:</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute CDP command via resolved handler (60s timeout).&quot;&quot;&quot;</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a>    <span class="n">handler</span><span class="p">,</span> <span class="n">session_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_routing</span><span class="p">()</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>    <span class="k">if</span> <span class="n">session_id</span><span class="p">:</span>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a>        <span class="n">command</span><span class="p">[</span><span class="s1">&#39;sessionId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">session_id</span>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a>    <span class="k">return</span> <span class="k">await</span> <span class="n">handler</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>Routing logic</strong>:</p>
<ol>
<li><strong>Element inside OOPIF iframe</strong>: Use <code>iframe_context.session_id</code> and <code>iframe_context.session_handler</code></li>
<li><strong>Nested iframe (child of OOPIF)</strong>: Use inherited <code>_routing_session_id</code> and <code>_routing_session_handler</code></li>
<li><strong>Regular element or in-process iframe</strong>: Use main connection (<code>_connection_handler</code>), no <code>sessionId</code></li>
</ol>
<h3 id="extended-command-typing">Extended Command Typing</h3>
<p>To make <code>sessionId</code> type-safe, Pydoll extended the <code>Command</code> TypedDict:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1"># From pydoll/protocol/base.py</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">Command</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">,</span> <span class="n">Generic</span><span class="p">[</span><span class="n">T_CommandParams</span><span class="p">,</span> <span class="n">T_CommandResponse</span><span class="p">]):</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Base structure for all commands.&quot;&quot;&quot;</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>    <span class="nb">id</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>    <span class="n">params</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="n">T_CommandParams</span><span class="p">]</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>    <span class="n">sessionId</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>  <span class="c1"># Added for flattened session routing</span>
</span></code></pre></div>
<p>This allows type-checkers to recognize <code>command['sessionId'] = '...'</code> as valid without suppressing type warnings.</p>
<hr />
<h2 id="performance-considerations">Performance Considerations</h2>
<h3 id="caching-strategy">Caching Strategy</h3>
<p><strong>First access is expensive</strong>:</p>
<ul>
<li><code>DOM.describeNode</code>: 1 round-trip</li>
<li>Frame tree retrieval: 1+ round-trips (main + OOPIF targets)</li>
<li><code>DOM.getFrameOwner</code> per frame: N round-trips (in worst case)</li>
<li><code>Target.getTargets</code> + attachments: 1 + M round-trips (M = number of OOPIF targets)</li>
<li><code>Page.createIsolatedWorld</code>: 1 round-trip</li>
<li><code>Runtime.evaluate</code> (document): 1 round-trip</li>
</ul>
<p><strong>Total</strong>: Potentially 5-20+ round-trips depending on page structure.</p>
<p><strong>Subsequent access is O(1)</strong>:</p>
<ul>
<li><code>iframe_context</code> is cached on the <code>WebElement</code> instance</li>
<li>Accessing <code>await iframe.iframe_context</code> multiple times returns the cached value immediately</li>
<li>All elements found within the iframe inherit the context (no re-resolution)</li>
</ul>
<h3 id="optimization-direct-child-target-lookup">Optimization: Direct Child Target Lookup</h3>
<p>In <code>_resolve_oopif_by_parent</code>, Pydoll first checks for direct children by <code>parentFrameId</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">direct_children</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>    <span class="n">target_info</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>    <span class="k">for</span> <span class="n">target_info</span> <span class="ow">in</span> <span class="n">target_infos</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>    <span class="k">if</span> <span class="n">target_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;iframe&#39;</span><span class="p">,</span> <span class="s1">&#39;page&#39;</span><span class="p">}</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>    <span class="ow">and</span> <span class="n">target_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parentFrameId&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">parent_frame_id</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="p">]</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="k">if</span> <span class="n">direct_children</span><span class="p">:</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>    <span class="c1"># Attach immediately, skip scanning all targets</span>
</span></code></pre></div>
<p><strong>Why this helps</strong>:</p>
<ul>
<li>Most OOPIFs have <code>parentFrameId</code> correctly set</li>
<li>Avoids attaching to every target speculatively</li>
<li>Reduces round-trips from O(targets) to O(1) in the common case</li>
</ul>
<h3 id="asynchronous-parallel-resolution-future-enhancement">Asynchronous Parallel Resolution (Future Enhancement)</h3>
<p>Currently, frame owner matching is sequential (check each frame one by one). A future optimization could parallelize:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># Current (sequential)</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="k">for</span> <span class="n">frame_node</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>    <span class="n">owner</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner_backend_for</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>    <span class="k">if</span> <span class="n">owner</span> <span class="o">==</span> <span class="n">backend_node_id</span><span class="p">:</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>        <span class="k">return</span> <span class="n">frame_node</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="c1"># Potential (parallel)</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">(</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_owner_backend_for</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">frame</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>    <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="p">))</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">owner</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>    <span class="k">if</span> <span class="n">owner</span> <span class="o">==</span> <span class="n">backend_node_id</span><span class="p">:</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>        <span class="k">return</span> <span class="n">frames</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span></code></pre></div>
<p>This would reduce latency from <code>N * RTT</code> to <code>RTT</code> (where RTT = round-trip time).</p>
<hr />
<h2 id="failure-modes-and-debugging">Failure Modes and Debugging</h2>
<h3 id="common-failure-scenarios">Common Failure Scenarios</h3>
<h4 id="1-invalidiframe-unable-to-resolve-frameid">1. <strong>InvalidIFrame: Unable to resolve frameId</strong></h4>
<p><strong>Cause</strong>:</p>
<ul>
<li>The iframe is dynamically created and hasn't fully initialized</li>
<li>The iframe is sandboxed with restrictive policies</li>
<li>Network issues delayed iframe loading</li>
</ul>
<p><strong>Solutions</strong>:</p>
<ul>
<li><strong>Wait for iframe</strong>: Use <code>await tab.find(id='iframe', timeout=10)</code> with a timeout</li>
<li><strong>Check sandbox attribute</strong>: Restrictive sandboxing (<code>&lt;iframe sandbox&gt;</code>) may block some CDP operations</li>
<li><strong>Retry strategy</strong>: Implement retry logic with exponential backoff</li>
</ul>
<p><strong>Debugging</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="k">try</span><span class="p">:</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>    <span class="n">iframe</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tab</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;problem-iframe&#39;</span><span class="p">)</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>    <span class="n">context</span> <span class="o">=</span> <span class="k">await</span> <span class="n">iframe</span><span class="o">.</span><span class="n">iframe_context</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="k">except</span> <span class="n">InvalidIFrame</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>    <span class="c1"># Inspect what we have</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>    <span class="n">node_info</span> <span class="o">=</span> <span class="k">await</span> <span class="n">iframe</span><span class="o">.</span><span class="n">_describe_node</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="n">iframe</span><span class="o">.</span><span class="n">_object_id</span><span class="p">)</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node info: </span><span class="si">{</span><span class="n">node_info</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>    <span class="c1"># Check frame tree manually</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>    <span class="n">frame_tree</span> <span class="o">=</span> <span class="k">await</span> <span class="n">WebElement</span><span class="o">.</span><span class="n">_get_frame_tree_for</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">_connection_handler</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Frame tree: </span><span class="si">{</span><span class="n">frame_tree</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="2-invalidiframe-unable-to-create-isolated-world">2. <strong>InvalidIFrame: Unable to create isolated world</strong></h4>
<p><strong>Cause</strong>:</p>
<ul>
<li>Frame has been destroyed/navigated away between resolution steps</li>
<li>Chrome bug (rare)</li>
</ul>
<p><strong>Solutions</strong>:</p>
<ul>
<li><strong>Re-resolve context</strong>: Clear cached context and re-access</li>
<li><strong>Check navigation</strong>: Ensure iframe isn't navigating during resolution</li>
</ul>
<p><strong>Debugging</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1"># Clear cache and retry</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="n">iframe</span><span class="o">.</span><span class="n">_iframe_context</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="n">context</span> <span class="o">=</span> <span class="k">await</span> <span class="n">iframe</span><span class="o">.</span><span class="n">iframe_context</span>
</span></code></pre></div>
<h4 id="3-invalidiframe-unable-to-obtain-document-reference">3. <strong>InvalidIFrame: Unable to obtain document reference</strong></h4>
<p><strong>Cause</strong>:</p>
<ul>
<li>The isolated world was created but the document isn't ready</li>
<li>Frame is about to navigate</li>
</ul>
<p><strong>Solutions</strong>:</p>
<ul>
<li>Wait for frame load: Use Page events to detect <code>Page.frameNavigated</code> or <code>Page.loadEventFired</code></li>
<li>Retry with a small delay</li>
</ul>
<h4 id="4-session-routing-failures-command-times-out-or-returns-error">4. <strong>Session routing failures (command times out or returns error)</strong></h4>
<p><strong>Cause</strong>:</p>
<ul>
<li>OOPIF target was detached (page navigated, iframe removed)</li>
<li><code>sessionId</code> is stale</li>
</ul>
<p><strong>Solutions</strong>:</p>
<ul>
<li><strong>Re-attach to target</strong>: Create a new <code>ConnectionHandler</code> and re-resolve OOPIF</li>
<li><strong>Validate target</strong>: Call <code>Target.getTargets()</code> to check if target still exists</li>
</ul>
<p><strong>Debugging</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># Check if session is still valid</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="n">targets</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">TargetCommands</span><span class="o">.</span><span class="n">get_targets</span><span class="p">())</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="n">active_sessions</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;targetId&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">][</span><span class="s1">&#39;targetInfos&#39;</span><span class="p">]]</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Active targets: </span><span class="si">{</span><span class="n">active_sessions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="k">if</span> <span class="n">iframe</span><span class="o">.</span><span class="n">_iframe_context</span> <span class="ow">and</span> <span class="n">iframe</span><span class="o">.</span><span class="n">_iframe_context</span><span class="o">.</span><span class="n">session_id</span><span class="p">:</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Our session: </span><span class="si">{</span><span class="n">iframe</span><span class="o">.</span><span class="n">_iframe_context</span><span class="o">.</span><span class="n">session_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="diagnostic-tools">Diagnostic Tools</h3>
<h4 id="enable-cdp-logging">Enable CDP logging</h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;pydoll&#39;</span><span class="p">)</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span></code></pre></div>
<p>This logs all CDP commands and responses, useful for tracing iframe resolution steps.</p>
<h4 id="inspect-iframe-context">Inspect iframe context</h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">iframe</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tab</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;my-iframe&#39;</span><span class="p">)</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="n">ctx</span> <span class="o">=</span> <span class="k">await</span> <span class="n">iframe</span><span class="o">.</span><span class="n">iframe_context</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Frame ID: </span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">frame_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Document URL: </span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">document_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Execution Context ID: </span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">execution_context_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Document Object ID: </span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">document_object_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session ID (OOPIF): </span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">session_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session Handler: </span><span class="si">{</span><span class="n">ctx</span><span class="o">.</span><span class="n">session_handler</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>
<hr />
<h2 id="conclusion">Conclusion</h2>
<p>Pydoll's iframe handling represents a sophisticated implementation of CDP's frame management capabilities. By understanding:</p>
<ul>
<li><strong>The DOM</strong>: Tree structure and node identification</li>
<li><strong>Iframes</strong>: Independent document contexts and security boundaries</li>
<li><strong>OOPIFs</strong>: Site isolation and target-based architecture</li>
<li><strong>CDP domains</strong>: Page, DOM, Target, Runtime coordination</li>
<li><strong>Execution contexts</strong>: Isolated worlds for clean automation</li>
<li><strong>Identifiers</strong>: backendNodeId, frameId, targetId, sessionId, executionContextId, objectId relationships</li>
<li><strong>Resolution pipeline</strong>: Multi-stage fallback strategy for finding frames</li>
<li><strong>Session routing</strong>: Flattened mode and automatic command routing</li>
</ul>
<p>you can appreciate why manual context switching is eliminated. The complexity is real, but Pydoll abstracts it behind a simple, intuitive API:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">iframe</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tab</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;login-frame&#39;</span><span class="p">)</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="n">username</span> <span class="o">=</span> <span class="k">await</span> <span class="n">iframe</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="k">await</span> <span class="n">username</span><span class="o">.</span><span class="n">type_text</span><span class="p">(</span><span class="s1">&#39;user@example.com&#39;</span><span class="p">)</span>
</span></code></pre></div>
<p>Three lines. No context switching. No target attachment. No session management. It just works.</p>
<hr />
<h2 id="further-reading">Further Reading</h2>
<ul>
<li><strong>CDP Specification</strong>: <a href="https://chromedevtools.github.io/devtools-protocol/tot/Page/">Chrome DevTools Protocol - Page Domain</a></li>
<li><strong>CDP Specification</strong>: <a href="https://chromedevtools.github.io/devtools-protocol/tot/DOM/">Chrome DevTools Protocol - DOM Domain</a></li>
<li><strong>CDP Specification</strong>: <a href="https://chromedevtools.github.io/devtools-protocol/tot/Target/">Chrome DevTools Protocol - Target Domain</a></li>
<li><strong>CDP Specification</strong>: <a href="https://chromedevtools.github.io/devtools-protocol/tot/Runtime/">Chrome DevTools Protocol - Runtime Domain</a></li>
<li><strong>Chromium Site Isolation</strong>: <a href="https://www.chromium.org/Home/chromium-security/site-isolation/">Site Isolation - The Chromium Projects</a></li>
<li><strong>Content Scripts &amp; Isolated Worlds</strong>: <a href="https://developer.chrome.com/docs/extensions/mv3/content_scripts/">Chrome Extensions - Content Scripts</a></li>
<li><strong>Pydoll Documentation</strong>: <a href="../cdp/">Deep Dive → Fundamentals → Chrome DevTools Protocol</a></li>
<li><strong>Pydoll Documentation</strong>: <a href="../../../features/automation/iframes/">Features → Automation → IFrames</a></li>
</ul>
<hr />
<div class="admonition tip">
<p class="admonition-title">Design Philosophy</p>
<p>The goal of Pydoll's iframe handling is <strong>ergonomic automation</strong>: write code as if iframes don't exist, and let the library handle the complexity. This deep dive showed what happens behind the scenes—but you never have to think about it in your automation scripts.</p>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.indexes", "navigation.expand", "navigation.path", "navigation.top", "toc.follow", "content.code.copy", "content.code.select", "content.tooltips", "search.highlight", "search.suggest"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../resources/scripts/termynal.js"></script>
      
        <script src="../../../resources/scripts/extra.js"></script>
      
        <script src="https://unpkg.com/mermaid@10.0.0/dist/mermaid.min.js"></script>
      
    
  </body>
</html>